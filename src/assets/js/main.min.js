/*! yii2-image-input - v0.2.0 - 2016-02-05 */!function(factory){"use strict";"function"==typeof define&&define.amd?define(["jquery"],factory):factory("object"==typeof exports?require("jquery"):jQuery)}(function($){"use strict";var defaults={className:"",text:"Drop Image",previewImage:!0,value:null,classes:{main:"dropzone",hint:"dropzone-hint",inner:"dropzone-inner",enter:"dropzone-enter",reject:"dropzone-reject",accept:"dropzone-accept",focus:"dropzone-focus"},validators:{maxSize:null,width:null,maxWidth:null,minWidth:null,height:null,maxHeight:null,minHeight:null},init:function(){},enter:function(){},leave:function(){},reject:function(){},accept:function(){},format:function(filename){return filename}};$.dropzone=function(element,options){this.settings=$.extend(!0,{},defaults,$.dropzone.defaults,options),this.$input=$(element);var self=this,settings=self.settings,$input=self.$input;if($input.is('input[type="file"]')&&$.dropzone.isBrowserCompatible()){var init=function(){var $dropzone,$container,value;$container=$('<div class="'+settings.classes.main+'" />').on("dragover.dropzone",function(){$(this).addClass(settings.classes.enter),$.isFunction(settings.enter)&&settings.enter.apply(this)}).on("dragleave.dropzone",function(){$(this).removeClass(settings.classes.enter),$.isFunction(settings.leaved)&&settings.leaved.apply(this)}).addClass(settings.className),$input.wrap($container).before('<div class="'+settings.classes.inner+'"><div  class="'+settings.classes.hint+'"><div><i class="fa fa-fw">ï‚“</i></div>'+settings.text+"</div></div>"),$dropzone=$input.parent("."+settings.classes.main),value=settings.value||$input.data("value"),value&&self.preview(value),$.isFunction(settings.init)&&settings.init.apply($input,[value]),$input.on("focus.dropzone",function(){$dropzone.addClass(settings.classes.focus)}).on("blur.dropzone",function(){$dropzone.removeClass(settings.classes.focus)}).on("change.dropzone",function(){var file=this.files[0];if(file){var basename=file.name.replace(/\\/g,"/").replace(/.*\//,""),extension=file.name.split(".").pop(),formatted=settings.format(basename);file.extension=extension;var allowed=$input.attr("accept"),accepted=!1,valid=!0,errors={mimeType:!1,maxSize:!1,width:!1,minWidth:!1,maxWidth:!1,height:!1,minHeight:!1,maxHeight:!1};if(allowed){var types=allowed.split(/[,|]/);$.each(types,function(i,type){if(type=$.trim(type),"."+extension===type)return accepted=!0,!1;if(file.type===type)return accepted=!0,!1;if(type.indexOf("/*")!==!1){var a=type.replace("/*",""),b=file.type.replace(/(\/.*)$/g,"");if(a===b)return accepted=!0,!1}}),accepted===!1&&(errors.mimeType=!0)}else accepted=!0;if($dropzone.removeClass(settings.classes.reject+" "+settings.classes.accept),accepted!==!0)return $input.val(""),$dropzone.addClass(settings.classes.reject),$.isFunction(settings.reject)&&settings.reject.apply($input,[file,errors]),!1;var reader=new FileReader(file);reader.readAsDataURL(file),reader.onload=function(e){var isImage,img=new Image;file.data=e.target.result,img.src=file.data,setTimeout(function(){isImage=img.width&&img.height,settings.validators.maxSize&&file.size>settings.validators.maxSize&&(valid=!1,errors.maxSize=!0),isImage&&(file.width=img.width,file.height=img.height,settings.validators.width&&img.width!==settings.validators.width&&(valid=!1,errors.width=!0),settings.validators.maxWidth&&img.width>settings.validators.maxWidth&&(valid=!1,errors.maxWidth=!0),settings.validators.minWidth&&img.width<settings.validators.minWidth&&(valid=!1,errors.minWidth=!0),settings.validators.height&&img.height!==settings.validators.height&&(valid=!1,errors.height=!0),settings.validators.maxHeight&&img.height>settings.validators.maxHeight&&(valid=!1,errors.maxHeight=!0),settings.validators.minHeight&&img.height<settings.validators.minHeight&&(valid=!1,errors.minHeight=!0)),valid===!0?($dropzone.find("img").remove(),isImage&&settings.previewImage===!0?$dropzone.find("div").html($(img)):$dropzone.find("div").html("<span>"+formatted+"</span>"),$dropzone.addClass(settings.classes.accept),$.isFunction(settings.accept)&&settings.accept.apply($input,[file])):($input.val(""),$dropzone.addClass(settings.classes.reject),$.isFunction(settings.reject)&&settings.reject.apply($input,[file,errors]))},250)}}})};init()}},$.dropzone.prototype.preview=function(path,callback){var settings=this.settings,$input=this.$input,$dropzone=$input.parent("."+settings.classes.main),basename=path.replace(/\\/g,"/").replace(/.*\//,""),formatted=settings.format(basename),img=new Image;img.src=path,img.onload=function(){$dropzone.find("div").html($(img)),$.isFunction(callback)&&callback.apply(this)},img.onerror=function(){$dropzone.find("div").html("<span>"+formatted+"</span>"),$.isFunction(callback)&&callback.apply(this)},$dropzone.addClass(settings.classes.accept)},$.dropzone.prototype.destroy=function(){var settings=this.settings,$input=this.$input;$input.parent("."+settings.classes.main).replaceWith($input),$input.off("*.dropzone"),$input.removeData("dropzone")},$.dropzone.prototype.options=function(options){var settings=this.settings;return options?void $.extend(!0,this.settings,options):settings},$.dropzone.prototype.container=function(){var settings=this.settings,$input=this.$input;return $input.parent("."+settings.classes.main)},$.dropzone.isBrowserCompatible=function(){return!!(window.File&&window.FileList&&window.FileReader)},$.dropzone.defaults=defaults,$.fn.dropzone=function(options){var plugin,args=arguments;return this.each(function(){return(plugin=$(this).data("dropzone"))?plugin[options]?plugin[options].apply(plugin,Array.prototype.slice.call(args,1)):void $.error("Dropzone error - Method "+options+" does not exist."):$(this).data("dropzone",new $.dropzone(this,options))})}});